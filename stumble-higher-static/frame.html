<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Stumble Higher – Frame</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <style>
    .btn{ @apply px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 text-white font-semibold; }
  </style>
</head>
<body class="bg-zinc-900 text-white flex items-center justify-center min-h-screen p-4">
  <div id="app" class="space-y-4 w-full max-w-md"></div>

  <script type="module">
    import { createMiniApp } from 'https://cdn.skypack.dev/@farcaster/frame-core';

    const resourcesUrl = './resources.json';
    let resources = [];

    const app = createMiniApp();

    async function init() {
      resources = await fetch(resourcesUrl).then(r => r.json()).then(d => d.Books);
      shuffle();
    }

    function shuffle() {
      const current = resources[Math.floor(Math.random() * resources.length)];
      render(current);
    }

    async function share(current) {
      await app.composeCast({
        text: `Found “${current.title}” on Stumble Higher → ${current.url} #StumbleHigher`
      });
    }

    function render(current) {
      const root = document.getElementById('app');
      root.innerHTML = `
        <article class="border rounded-2xl p-4 shadow-lg bg-gradient-to-br from-zinc-900 to-zinc-800">
          <h2 class="text-xl font-bold mb-1">${current.title}</h2>
          <p class="opacity-80 mb-3">${current.author ?? ''}</p>
          <a href="${current.url}" target="_blank" rel="noopener" class="underline">Open in new tab ↗</a>
        </article>
        <div class="flex gap-3">
          <button id="btn-shuffle" class="btn grow">Stumble Again</button>
          <button id="btn-share" class="btn grow">Share ↗</button>
        </div>
      `;
      document.getElementById('btn-shuffle')?.addEventListener('click', shuffle);
      document.getElementById('btn-share')?.addEventListener('click', () => share(current));
    }

    app.onReady(init);
  </script>
</body>
</html>
