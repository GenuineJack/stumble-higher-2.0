<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Stumble Higher – Explore</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--brand:#FF6D0E;}
.btn{ @apply px-4 py-2 rounded-full font-semibold text-sm w-full flex justify-center items-center;}
.btn-brand{background-color:var(--brand);}
.btn-brand:hover{background-color:#e05f04;}
</style>
</head>
<body class="bg-zinc-900 text-white flex flex-col h-screen">
<iframe id="webview" class="flex-1 w-full bg-zinc-800" sandbox="allow-scripts allow-same-origin allow-popups"></iframe>

<!-- bottom dock -->
<div class="bg-zinc-950/80 backdrop-blur-sm p-3 space-y-2">
  <div>
    <h2 id="resTitle" class="font-semibold text-sm"></h2>
    <p id="resDesc" class="text-xs opacity-70"></p>
  </div>
  <div class="grid grid-cols-3 gap-3">
    <button id="openBtn" class="btn btn-brand" title="Open in new tab">🌐</button>
    <button id="stumbleBtn" class="btn btn-brand" title="Stumble Higher">Stumble</button>
    <button id="shareBtn" class="btn btn-brand" title="Share">↗</button>
  </div>
</div>

<script type="module">
// Farcaster helpers
const Ready=()=>window.parent.postMessage({type:'ready'},'*');
const ComposeCast=payload=>window.parent.postMessage({type:'compose_cast',...payload},'*');

let resources=[], current=null;

fetch('resources.json')  // relative path
  .then(r=>r.json())
  .then(d=>{ resources=d.Sites; start(); })
  .catch(()=>alert('Could not load resources'));

const webview=document.getElementById('webview');
const resTitle=document.getElementById('resTitle');
const resDesc=document.getElementById('resDesc');
const stumbleBtn=document.getElementById('stumbleBtn');
const openBtn=document.getElementById('openBtn');
const shareBtn=document.getElementById('shareBtn');

function pickRandom(){
  if(resources.length===0) return null;
  let next=resources[Math.floor(Math.random()*resources.length)];
  while(next===current && resources.length>1){
    next=resources[Math.floor(Math.random()*resources.length)];
  }
  return next;
}

function load(res){
  if(!res) return;
  current=res;
  webview.src=res.url;
  resTitle.textContent=res.title;
  resDesc.textContent=res.description||'';
}

function stumble(){ load(pickRandom()); }

function start(){
  stumble();
  if(window.parent!==window) Ready();
}

stumbleBtn.onclick=stumble;
openBtn.onclick=()=>{ if(current) window.open(current.url,'_blank'); };
shareBtn.onclick=()=>{ if(current) ComposeCast({text:`Found "${current.title}" on Stumble Higher – ${current.url} #StumbleHigher`}); };
</script>
</body>
</html>
