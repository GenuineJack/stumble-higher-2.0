<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Stumble Higher – Frame</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
</head>
<body class="bg-zinc-900 text-white flex items-center justify-center min-h-screen p-4">
  <div id="app" class="space-y-4 w-full max-w-md"></div>

  <script type="module">
    import { createMiniApp } from 'https://esm.sh/@farcaster/frame-core@1.1.0?bundle';

    const app = createMiniApp();

    // Fetch resources once
    const resources = await fetch('./resources.json').then(r => r.json()).then(j => j.Books);

    function render(card){
      const root=document.getElementById('app');
      root.innerHTML=`
        <article class="border rounded-2xl p-4 shadow-lg bg-gradient-to-br from-zinc-900 to-zinc-800">
          <h2 class="text-xl font-bold mb-1">${card.title}</h2>
          <p class="opacity-80 mb-3">${card.author ?? ''}</p>
          <a href="${card.url}" target="_blank" class="underline">Open in new tab ↗</a>
        </article>
        <div class="flex gap-3">
          <button id="again" class="px-4 py-2 flex-1 rounded-full bg-purple-600 hover:bg-purple-700 font-semibold">Stumble Again</button>
          <button id="share" class="px-4 py-2 flex-1 rounded-full bg-purple-600 hover:bg-purple-700 font-semibold">Share ↗</button>
        </div>
      `;
      document.getElementById('again').onclick = showRandom;
      document.getElementById('share').onclick = () => app.composeCast({
        text: \`Found “${card.title}” on Stumble Higher → ${card.url} #StumbleHigher\`
      });
    }

    function showRandom(){ render(resources[Math.floor(Math.random()*resources.length)]); }

    // Host -> frame: ready event; then we render and notify host we're ready
    app.onReady(() => {
      showRandom();
      app.ready(); // 🚀 notify Farcaster we are good to display
    });
  </script>
</body>
</html>
