<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Stumble Higher â€“ Frame</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.btn{ @apply flex items-center gap-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-full font-semibold text-sm;}
</style>
</head>
<body class="bg-zinc-900 text-white flex flex-col h-screen">
<iframe id="webview" class="flex-1 w-full bg-zinc-800" src="" sandbox="allow-scripts allow-same-origin allow-popups"></iframe>

<!-- bottom dock -->
<div class="bg-zinc-950/80 backdrop-blur-sm p-3 flex items-center gap-3">
  <div class="flex-1">
    <h2 id="resTitle" class="font-semibold text-sm"></h2>
    <p id="resDesc" class="text-xs opacity-70"></p>
  </div>
  <button id="stumbleBtn" class="btn">Stumble Higher</button>
  <button id="openBtn" class="btn" title="Open in new tab">ğŸŒ</button>
  <button id="shareBtn" class="btn" title="Share">â†—</button>
</div>

<script type="module">
// Tiny Farcaster helpers
const Ready=()=>window.parent.postMessage({type:'ready'},'*');
const ComposeCast=payload=>window.parent.postMessage({type:'compose_cast',...payload},'*');

let resources=[], current=null;

fetch('resources.json').then(r=>r.json()).then(d=>{resources=d.Sites; start();}).catch(()=>alert('Failed to load resources'));

const webview=document.getElementById('webview');
const resTitle=document.getElementById('resTitle');
const resDesc=document.getElementById('resDesc');
const stumbleBtn=document.getElementById('stumbleBtn');
const openBtn=document.getElementById('openBtn');
const shareBtn=document.getElementById('shareBtn');

function pickRandom(){
  const next=resources[Math.floor(Math.random()*resources.length)];
  return next===current?pickRandom():next;
}

function load(res){
  current=res;
  webview.src=res.url;
  resTitle.textContent=res.title;
  resDesc.textContent=res.description||'';
}

function stumble(){ load(pickRandom()); }

function start(){
  stumble();
  if(window.parent!==window) Ready();
}

stumbleBtn.onclick=stumble;
openBtn.onclick=()=>{ if(current) window.open(current.url,'_blank') };
shareBtn.onclick=()=>{
  if(current) ComposeCast({text:`Found "${current.title}" on Stumble Higher â€“ ${current.url} #StumbleHigher`});
};
</script>
</body>
</html>
