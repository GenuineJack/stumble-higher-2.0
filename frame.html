<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Stumble Higher â€“ Explore</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--brand:#FF6D0E;}
.btn{ @apply px-4 py-2 rounded-full font-semibold text-xs w-full flex justify-center items-center;}
.btn-brand{background-color:var(--brand);}
.btn-brand:hover{background-color:#e05f04;}
</style>
</head>
<body class="bg-zinc-900 text-white flex flex-col h-screen">
<iframe id="webview" class="flex-1 w-full bg-zinc-800" sandbox="allow-scripts allow-popups"></iframe>

<!-- Bottom nav -->
<div class="bg-zinc-950/80 backdrop-blur-sm p-3 space-y-2">
  <div class="min-h-[48px]">
    <h2 id="title" class="font-semibold text-sm truncate"></h2>
    <p id="desc" class="text-xs opacity-70 truncate"></p>
  </div>
  <div class="grid grid-cols-4 gap-3">
    <button id="homeBtn" class="btn btn-brand" title="Home">ğŸ </button>
    <button id="openBtn" class="btn btn-brand" title="Open">ğŸŒ</button>
    <button id="stumbleBtn" class="btn btn-brand" title="Stumble Higher">STUMBLEÂ HIGHER</button>
    <button id="shareBtn" class="btn btn-brand" title="Share">ğŸ“¤</button>
  </div>
</div>

<script type="module">
const Ready=()=>window.parent.postMessage({type:'ready'},'*');
const ComposeCast=p=>window.parent.postMessage({type:'compose_cast',...p},'*');

let list=[], current=null;

async function loadList(){
  try{
    const data=await fetch(new URL('resources.json', location.origin)).then(r=>r.json());
    list=data.resources||data.sites||data.Sites||[];
  }catch(e){
    console.error(e); alert('Could not load resources.');
  }
}

function random(){
  if(!list.length) return null;
  let pick=list[Math.floor(Math.random()*list.length)];
  if(list.length>1){
    while(pick===current) pick=list[Math.floor(Math.random()*list.length)];
  }
  return pick;
}

function render(res){
  const t=document.getElementById('title');
  const d=document.getElementById('desc');
  if(!res){ t.textContent='No resources'; d.textContent=''; return;}
  current=res;
  document.getElementById('webview').src=res.url;
  t.textContent=res.title; d.textContent=res.description||'';
}

document.getElementById('stumbleBtn').onclick=()=>render(random());
document.getElementById('openBtn').onclick=()=>current && window.open(current.url,'_blank');
document.getElementById('shareBtn').onclick=()=>current && ComposeCast({text:`Found "${current.title}" on Stumble Higher â€“ ${current.url} #StumbleHigher`});
document.getElementById('homeBtn').onclick=()=>window.location.href='/';

(async()=>{
  await loadList();
  render(random());
  if(window.parent!==window) Ready();
})();
</script>
</body>
</html>
